<!DOCTYPE html>
<html lang="en">

<head>
      <meta charset="UTF-8">
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <title>Code Editor</title>
      <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.5/codemirror.min.css">
      <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.5/theme/dracula.min.css">
      <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.5/theme/material.min.css">
      <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.5/theme/eclipse.min.css">
      <style>
            body,
            html {
                  margin: 0;
                  padding: 0;
                  height: 100%;
                  font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            }

            .container {
                  display: flex;
                  flex-direction: column;
                  height: 100%;
            }

            .header {
                  background-color: #333;
                  color: white;
                  padding: 10px;
                  display: flex;
                  justify-content: space-between;
                  align-items: center;
                  flex-wrap: wrap;
            }

            .header select,
            .header button {
                  padding: 8px;
                  margin-right: 10px;
                  background-color: #444;
                  color: white;
                  border: none;
                  border-radius: 4px;
            }

            .file-tabs {
                  display: flex;
                  margin-bottom: 10px;
                  overflow-x: auto;
            }

            .file-tab {
                  padding: 8px 15px;
                  margin-right: 5px;
                  background-color: #444;
                  color: white;
                  border: none;
                  cursor: pointer;
                  border-radius: 4px;
                  font-size: 14px;
            }

            .file-tab.active {
                  background-color: #555;
            }

            .editor-container {
                  flex: 1;
                  padding: 20px;
                  overflow: hidden;
                  position: relative;
            }

            .output-container {
                  background-color: #1e1e1e;
                  color: white;
                  min-height: 30vh;
                  padding: 10px;
                  overflow-y: auto;
                  font-size: 14px;
                  resize: vertical;
                  border-top: 1px solid #ccc;
                  transition: height 0.3s ease;
                  max-height: 60vh;
                  white-space: pre-wrap;
                  overflow-x: auto;
            }

            .resize-bar {
                  background-color: #444;
                  height: 5px;
                  cursor: row-resize;
                  margin-top: 10px;
            }

            textarea {
                  width: 100%;
                  height: 100%;
                  background-color: #282a36;
                  color: #f8f8f2;
                  border: none;
                  padding: 10px;
                  border-radius: 4px;
                  resize: none;
            }

            .file-tab-buttons {
                  margin-left: 10px;
            }

            #runButton {
                  background-color: #28a745;
                  color: white;
                  border: none;
                  border-radius: 4px;
                  padding: 8px 12px;
                  cursor: pointer;
            }

            #runButton:hover {
                  background-color: #218838;
            }

            .expandable {
                  cursor: pointer;
                  color: #ccc;
            }

            .collapsed {
                  display: none;
            }

            .collapsed ul {
                  list-style-type: none;
                  padding-left: 20px;
            }

            /* Custom styles for the suggestion block */
            .CodeMirror-hints {
                  background-color: #444;
                  border: 1px solid #666;
                  color: white;
                  font-size: 14px;
                  max-height: 200px;
                  overflow-y: auto;
                  box-shadow: 0 4px 6px rgba(0, 0, 0, 0.2);
                  z-index: 9999;
                  position: absolute !important;
            }

            .CodeMirror-hints ul {
                  padding: 0;
                  margin: 0;
            }

            .CodeMirror-hints li {
                  padding: 5px 10px;
                  cursor: pointer;
            }

            .CodeMirror-hints li:hover {
                  background-color: #555;
            }
      </style>
</head>

<body>
      <div class="container">
            <div class="header">
                  <div>
                        <select id="themeSelector">
                              <option value="dracula">Dracula</option>
                              <option value="material">Material</option>
                              <option value="eclipse">Eclipse</option>
                        </select>
                        <select id="fontSizeSelector">
                              <option value="14px">14px</option>
                              <option value="16px">16px</option>
                              <option value="18px">18px</option>
                              <option value="20px">20px</option>
                        </select>
                        <button id="newFileButton">New File</button>
                        <button id="saveFileButton">Save</button>
                        <button id="exportButton">Export</button>
                        <button id="runButton">Run</button>
                  </div>
                  <div class="file-tabs" id="fileTabs"></div>
            </div>

            <div class="editor-container">
                  <textarea id="jsCode" placeholder="Write your JavaScript code here..."></textarea>
            </div>

            <div id="output" class="output-container"></div>
            <div id="resizeBar" class="resize-bar"></div>
      </div>

      <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.5/codemirror.min.js"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.5/addon/edit/closebrackets.min.js"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.5/addon/hint/show-hint.min.js"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.5/addon/hint/javascript-hint.min.js"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.5/mode/javascript/javascript.min.js"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.7.1/jszip.min.js"></script>

      <script>
            // Create CodeMirror editor
            const editor = CodeMirror.fromTextArea(document.getElementById('jsCode'), {
                  mode: 'javascript',
                  theme: 'dracula',
                  lineNumbers: true,
                  autoCloseBrackets: true,
                  extraKeys: {
                        "Ctrl-Space": "autocomplete", // Trigger autocomplete with Ctrl + Space
                        "'.'": function (cm) {
                              setTimeout(function () {
                                    cm.execCommand("autocomplete"); // Trigger autocomplete when dot is pressed
                              }, 100);
                              return CodeMirror.Pass;
                        }
                  },
                  hintOptions: {
                        hint: CodeMirror.hint.javascript
                  }
            });

            document.getElementById('themeSelector').addEventListener('change', (e) => {
                  editor.setOption('theme', e.target.value);
                  localStorage.setItem('theme', e.target.value);
            });

            document.getElementById('fontSizeSelector').addEventListener('change', (e) => {
                  document.documentElement.style.fontSize = e.target.value;
                  localStorage.setItem('fontSize', e.target.value);
            });

            (function () {
                  const outputContainer = document.getElementById('output');
                  const originalLog = console.log;
                  console.log = function (...args) {
                        outputContainer.textContent += args.join(' ') + '\n';
                        originalLog.apply(console, args);
                  };
            })();

            document.getElementById('runButton').addEventListener('click', () => {
                  const code = editor.getValue();
                  const outputContainer = document.getElementById('output');
                  outputContainer.textContent = '';

                  try {
                        const output = eval(code);
                        if (output !== undefined) {
                              console.log(output);
                        }
                  } catch (error) {
                        console.error(error);
                  }
            });
      </script>
</body>

</html>